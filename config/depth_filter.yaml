# =============================================================================
# Depth Filter Configuration — Pre-processes ZED depth before RTAB-Map
# =============================================================================
# Stages:
#   1. PassThrough: remove out-of-range + NaN pixels
#   2. Temporal: average N frames to reduce flicker noise
#   3. Bilateral: edge-preserving smoothing
#   4. Hole filling: morphological closing + inpainting
# =============================================================================

/**:
  ros__parameters:
    # ── Range filter ──
    min_depth:                   0.3              # Meters (ZED 2i min)
    max_depth:                   10.0             # Meters (greenhouse max)

    # ── Temporal averaging ──
    enable_temporal:             true
    temporal_window:             2                # Average 2 frames (~67ms at 30fps)
                                                  # Reduced from 3: lower latency at 30Hz
                                                  # ZED depth_stabilization handles smoothing

    # ── Bilateral filter ──
    enable_bilateral:            false            # Disabled: saves ~5ms/frame
                                                  # ZED PERFORMANCE + depth_stabilization
                                                  # already handles edge smoothing
    bilateral_d:                 5                # Kernel diameter (keep small for speed)
    bilateral_sigma_color:       50.0             # Color similarity (depth domain)
    bilateral_sigma_space:       50.0             # Spatial proximity

    # ── Hole filling ──
    enable_hole_filling:         false            # Enable if you see many small holes
    hole_kernel_size:            3                # Morphological kernel (pixels)

    # ── Topics ──
    input_depth_topic:           '/zed/zed_node/depth/depth_registered'
    input_rgb_topic:             '/zed/zed_node/rgb/color/rect/image'
    output_depth_topic:          '/filtered/depth'
    output_rgb_topic:            '/filtered/rgb'
